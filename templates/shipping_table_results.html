{% if results %}
{% for result in results %}
<tr>
  {% if current_user.rank=='admin' %}
  <td>{{ result.id }}</td>
  <td>{{ result.date_created.strftime('%Y-%m-%d %H:%M') }}</td>
  {% endif %}

  <td>{{ result.carrier }}</td>
  <td>{{ result.service }}</td>
  <td>{{ result.routing }}</td>
  <td>{{ result.MV }}</td>
  <td>{{ result.POL }}</td>
  <td>{{ result.POD }}</td>
  <td>{{ result.CY_Open.strftime('%Y-%m-%d') }}</td>
  <td>{{ result.SI_Cut_Off.strftime('%Y-%m-%d %H:%M') }}</td>
  <td>{{ result.CY_CY_CLS.strftime('%Y-%m-%d %H:%M') }}</td>
  <td>{{ result.ETD.strftime('%Y-%m-%d') }}</td>
  <td>{{ result.ETA.strftime('%Y-%m-%d') }}</td>

  <td>
    <div class="d-inline-flex gap-2">
      <button class="btn btn-primary" type="button" data-bs-toggle="collapse"
        data-bs-target="#collapse{{ result.id }}" aria-expanded="false" aria-controls="collapse{{ result.id }}">Details
        <i class="bi bi-caret-down-fill"></i></button>
      {% if current_user.rank=='admin' %}
      <a class="btn btn-warning" href="{{ url_for('admin.edit_shipping_data', id=result.id) }}">Edit</a>
      <form action="{{ url_for('admin.delete_shipping_data', id=result.id) }}" method="POST">
        <button class="btn btn-danger is-danger" type="submit"
          onclick="return confirm('Are you sure you want to delete this item?');">Delete</button>
      </form>
      {% elif current_user.id == result.user_id %}
      <a class="btn btn-primary" href="{{ url_for('user.edit_shipping_data', id=result.id) }}">Edit</a>
      <form action="{{ url_for('user.delete_shipping_data', id=result.id) }}" method="POST">
        <button class="btn btn-danger is-danger" type="submit"
          onclick="return confirm('Are you sure you want to delete this item?');">Delete</button>
      </form>
    </div>
    {% endif %}
  </td>
</tr>
<tr>
  <td colspan="14">
    <div class="collapse" id="collapse{{ result.id }}">
      <table class="table table-striped align-middle">
        <thead>
          <th>CS</th>
          <th>Week</th>
          <th>SO</th>
          <th>Size</th>
          <th>Final Destination</th>
          <th>Contract/Coloader</th>
          <th>Cost</th>
          <th>Date Valid</th>
        </thead>
        <tbody>
          {% for booking in result.bookings %}
          <tr>
            <td>{{ booking.CS }}</td>
            <td>{{ booking.week }}</td>
            <td>{{ booking.SO }}</td>
            <td>{{ booking.size }}</td>
            <td>{{ booking.Final_Destination }}</td>
            <td>{{ booking.Contract_or_Coloader }}</td>
            <td>{{ booking.cost }}</td>
            <td>{{ booking.Date_Valid.strftime('%Y-%m-%d') }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <table class="table table-striped align-middle">
        <thead>
          <th>Shipper</th>
          <th>Consignee</th>
          <th>Term</th>
          <th>Salesman</th>
          <th>SR</th>
          <th>remark</th>
        </thead>
        <tbody>
          {% for order in result.confirm_orders %}
          <tr>
            <td>{{ order.shipper }}</td>
            <td>{{ order.consignee }}</td>
            <td>{{ order.term }}</td>
            <td>{{ order.salesman }}</td>
            <td>{{ order.SR }}</td>
            <td>{{ order.remark }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </td>
</tr>
{% endfor %}
{% else %}
<tr>
  <td colspan="14">No results found.</p>
</tr>
{% endif %}