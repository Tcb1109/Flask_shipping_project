{% if results %}
{% for result in results %}
<tr>
  {% if current_user.rank == 'admin' %}
  <td>{{ result.id }}</td>
  <td>{{ result.date_created.strftime('%Y-%m-%d %H:%M') }}</td>
  {% endif %}

  <td>{{ result.carrier }}</td>
  <td>{{ result.service }}</td>
  <td>{{ result.routing }}</td>
  <td>{{ result.MV }}</td>
  <td>{{ result.POL }}</td>
  <td>{{ result.POD }}</td>
  <td>{{ result.CY_Open.strftime('%Y-%m-%d') }}</td>
  <td>{{ result.SI_Cut_Off.strftime('%Y-%m-%d %H:%M') }}</td>
  <td>{{ result.CY_CY_CLS.strftime('%Y-%m-%d %H:%M') }}</td>
  <td>{{ result.ETD.strftime('%Y-%m-%d') }}</td>
  <td>{{ result.ETA.strftime('%Y-%m-%d') }}</td>

  {% if result.status=="s1" %}
  <td>No Booking</td>
  {% elif result.status=="s2" %}
  <td>Not confirmed</td>
  {% elif result.status=="s3" %}
  <td>Confirmed</td>
  {% else %}
  <td>Error</td>
  {% endif %}

  <td>
    <div class="d-inline-flex gap-2">
      <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse"
        data-bs-target="#collapse{{ result.id }}" aria-expanded="false" aria-controls="collapse{{ result.id }}">
        <i class="bi bi-zoom-in"></i>
      </button>
      {% if current_user.rank == 'admin' %}
      <a class="btn btn-warning" href="{{ url_for('admin.edit_shipping_data', id=result.id) }}"><i
          class="bi bi-pencil-square"></i></a>
      <form action="{{ url_for('admin.delete_shipping_data', id=result.id) }}" method="POST">
        <button class="btn btn-danger is-danger" type="submit"
          onclick="return confirm('Are you sure you want to delete this schedule?');"><i
            class="bi bi-trash3-fill"></i></button>
      </form>
      {% elif current_user.id == result.user_id %}
      <a class="btn btn-warning" href="{{ url_for('user.edit_shipping_data', id=result.id) }}"><i
          class="bi bi-pencil-square"></i></a>
      <form action="{{ url_for('user.delete_shipping_data', id=result.id) }}" method="POST">
        <button class="btn btn-danger is-danger" type="submit"
          onclick="return confirm('Are you sure you want to delete this schedule?');"><i
            class="bi bi-trash3-fill"></i></button>
      </form>
      {% endif %}
    </div>
  </td>
</tr>
<tr>
  <td colspan="14">
    <div class="collapse" id="collapse{{ result.id }}">
      <div class="d-flex justify-content-between align-items-baseline gap-2">
        <h5>Bookings</h5>
        <a class="btn btn-outline-primary">Add Booking</a>
      </div>
      <table class="table table-striped align-middle">
        <thead>
          <th>CS</th>
          <th>Week</th>
          <th>SO</th>
          <th>Size</th>
          <th>Final Destination</th>
          <th>Contract/Coloader</th>
          <th>Cost</th>
          <th>Date Valid</th>
          <th>Booking Actions</th>
        </thead>
        <tbody>
          {% if result.bookings %}
          {% for booking in result.bookings %}
          <tr>
            <td>{{ booking.CS }}</td>
            <td>{{ booking.week }}</td>
            <td>{{ booking.SO }}</td>
            <td>{{ booking.size }}</td>
            <td>{{ booking.Final_Destination }}</td>
            <td>{{ booking.Contract_or_Coloader }}</td>
            <td>{{ booking.cost }}</td>
            <td>{{ booking.Date_Valid.strftime('%Y-%m-%d') }}</td>{% if current_user.rank == 'admin' %}
            <a class="btn btn-warning" href="{{ url_for('admin.edit_shipping_data', id=result.id) }}"><i
                class="bi bi-pencil-square"></i></a>
            <form action="{{ url_for('admin.delete_shipping_data', id=result.id) }}" method="POST">
              <button class="btn btn-danger is-danger" type="submit"
                onclick="return confirm('Are you sure you want to delete this item?');"><i
                  class="bi bi-trash3-fill"></i></button>
            </form>
            {% elif current_user.id == result.user_id %}
            <a class="btn btn-warning" href="{{ url_for('user.edit_shipping_data', id=result.id) }}"><i
                class="bi bi-pencil-square"></i></a>
            <form action="{{ url_for('user.delete_shipping_data', id=result.id) }}" method="POST">
              <button class="btn btn-danger is-danger" type="submit"
                onclick="return confirm('Are you sure you want to delete this item?');"><i
                  class="bi bi-trash3-fill"></i></button>
            </form>
            {% endif %}
          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td colspan="14">No bookings found.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
      <h5>Confirmation</h5>
      <table class="table table-striped align-middle">
        <thead>
          <th>Shipper</th>
          <th>Consignee</th>
          <th>Term</th>
          <th>Salesman</th>
          <th>SR</th>
          <th>remark</th>
        </thead>
        <tbody>
          {% if result.confirm_orders %}
          <tr>
            <td>{{ result.confirm_orders.shipper }}</td>
            <td>{{ result.confirm_orders.consignee }}</td>
            <td>{{ result.confirm_orders.term }}</td>
            <td>{{ result.confirm_orders.salesman }}</td>
            <td>{{ result.confirm_orders.SR }}</td>
            <td>{{ result.confirm_orders.remark }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="14">Order not confirmed.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </td>
</tr>
{% endfor %}
{% else %}
<tr>
  <td colspan="14">No results found.</td>
</tr>
{% endif %}